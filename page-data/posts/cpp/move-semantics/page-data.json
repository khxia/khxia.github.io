{"componentChunkName":"component---src-templates-blog-template-js","path":"/posts/cpp/move-semantics","result":{"data":{"markdownRemark":{"html":"<h2>Introduction</h2>\n<p>So you've finished (UCLA) CS32, and know basic C++, data structures, and all that. But it stops there. Nobody really teaches more about C++. Everyone tells you that \"C++ is very fast, but it's very tedious\", or \"C++ is fast only if you know how to make it fast\", but they don't really tell you <strong>how</strong> to make it fast. </p>\n<p>But that's not really the curriculums fault, the purpose of those introductory CS classes is to get students to master basic programming concepts and learn the fundamentals of object-oriented programming. C++ just happens to be the language that UCLA has chosen to teach in. After CS31 and CS32, UCLA students rarely get the opportunity to program in C++, with the majorty of classes favoring other imperative programming languages over C++ like Java, Python, and C.</p>\n<p>But not to worry, this blog will attempt to give you a <strong>killer</strong> introduction on how <strong>move semantics</strong> work in C++. Even though the term sounds scary, it's really just another way that C++ programmers can make their programs even faster.</p>\n<p align=\"center\">\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 633px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/8bec73155cadd2eed4a9c811eaa6ae27/054c0/koro-sensei.jpg\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 57.05882352941176%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAALABQDASIAAhEBAxEB/8QAFwABAQEBAAAAAAAAAAAAAAAABAACA//EABUBAQEAAAAAAAAAAAAAAAAAAAAB/9oADAMBAAIQAxAAAAESw8oVao//xAAbEAABBAMAAAAAAAAAAAAAAAADAQIREgAhQf/aAAgBAQABBQLcLQZDOlxc7VFb/8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAwEBPwE//8QAFREBAQAAAAAAAAAAAAAAAAAAABH/2gAIAQIBAT8BV//EABkQAQEBAAMAAAAAAAAAAAAAAAABAhIxcf/aAAgBAQAGPwJnjb08RGbX/8QAGxAAAwEAAwEAAAAAAAAAAAAAAAERIVGhscH/2gAIAQEAAT8ha0rK5hPekWVRGZhcLwfShIxs+n//2gAMAwEAAgADAAAAEDPP/8QAFxEAAwEAAAAAAAAAAAAAAAAAAAEhEf/aAAgBAwEBPxBKaU//xAAYEQACAwAAAAAAAAAAAAAAAAAAEQEhQf/aAAgBAgEBPxC5Qun/xAAeEAEBAAEDBQAAAAAAAAAAAAABEQAhUWExQYGhsf/aAAgBAQABPxAoc3nLD8arV6PnBMGEncxJah2+a+4kMWKJvcvBbFqWIPQZ/9k='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"koro-sensei\"\n        title=\"koro-sensei\"\n        src=\"/static/8bec73155cadd2eed4a9c811eaa6ae27/054c0/koro-sensei.jpg\"\n        srcset=\"/static/8bec73155cadd2eed4a9c811eaa6ae27/651be/koro-sensei.jpg 170w,\n/static/8bec73155cadd2eed4a9c811eaa6ae27/d30a3/koro-sensei.jpg 340w,\n/static/8bec73155cadd2eed4a9c811eaa6ae27/054c0/koro-sensei.jpg 633w\"\n        sizes=\"(max-width: 633px) 100vw, 633px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n</p>\n<h2>The Opening Problem:</h2>\n<p>Let's say that you're a rookie software engineer that works at <strong>MADE entertainment</strong>, a Korean entertainment company. Your manager wants you to write a program that reports the company's data on its actors and singers. Moreover, since this program is going to be called multiple times by internal systems and displayed on the company website, performance is of the utmost importance. </p>\n<p>Naively, you choose C++ to write your program, and naively, you write the following program:</p>\n<div class=\"gatsby-highlight\" data-language=\"cpp\"><pre class=\"language-cpp\"><code class=\"language-cpp\">std<span class=\"token operator\">::</span>vector<span class=\"token operator\">&lt;</span>std<span class=\"token operator\">::</span>string<span class=\"token operator\">></span> <span class=\"token function\">build_vector</span><span class=\"token punctuation\">(</span>dbConnection db<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    std<span class=\"token operator\">::</span>vector<span class=\"token operator\">&lt;</span>std<span class=\"token operator\">::</span>string<span class=\"token operator\">></span> vec<span class=\"token punctuation\">;</span>\n    <span class=\"token comment\">// fill the vector with thousands of entries</span>\n    <span class=\"token keyword\">return</span> vec<span class=\"token punctuation\">;</span>  <span class=\"token comment\">// vec is copied here</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">void</span> <span class=\"token function\">report_statistics</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    std<span class=\"token operator\">::</span>vector<span class=\"token operator\">&lt;</span>std<span class=\"token operator\">::</span>string<span class=\"token operator\">></span> data<span class=\"token punctuation\">;</span>\n\n    data <span class=\"token operator\">=</span> <span class=\"token function\">build_vector</span><span class=\"token punctuation\">(</span>singers_db<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  <span class=\"token comment\">// the return value is copied and assigned to data</span>\n    <span class=\"token comment\">//  report singer statistics</span>\n\n    data <span class=\"token operator\">=</span> <span class=\"token function\">build_vector</span><span class=\"token punctuation\">(</span>actors_db<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  <span class=\"token comment\">// the return value is copied and assigned to data</span>\n    <span class=\"token comment\">// report actor statistics</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Oh no! This code seems fine, but you forgot that due to certain legacy code remaining in the codebase, <strong>MADE Entertainment</strong> systems still run on C++98. In which case, your code is super <em>inefficient</em>. Why? Because for every call to <code class=\"language-text\">build_vector</code>, we are first filling a <code class=\"language-text\">vector</code> with thousands of entries, and then copying it <em>twice</em>. </p>\n<ul>\n<li>We copy the vector once when we return from the <code class=\"language-text\">build_vector</code> function. Because <code class=\"language-text\">vec</code> is a local variable that we then <code class=\"language-text\">return</code> in our function, since <code class=\"language-text\">vec</code> will soon go away, C++ will copy the data and then return it back to the calling function</li>\n<li>We copy the vector another time when we assign the return vector that we just copied into <code class=\"language-text\">data</code>. This is because the return values of functions are also treated as temporary variables, which means that C++ will copy the data again, and then have <code class=\"language-text\">data</code> refer to that new copied data.</li>\n</ul>\n<p>An animated representation of the above looks like the following:</p>\n<p align=\"center\">\n<p><img src=\"https://github.com/khxia/khxia.github.io/blob/dev2/src/posts/cpp/copy.gif?raw=true\"></img></p>\n</p>\n<p>Hence, we see that although the code that you wrote looks pretty intuitive, it is actually very inefficient. Your manager would probably tell you to change your code to use pointers instead to avoid the uncessary copying. However, <strong>jokes on him</strong> because in C++11, the code that you wrote is perfectly valid and will result in 0 copying of the <code class=\"language-text\">vector</code> that you created. </p>\n<blockquote>\n<p>Why?</p>\n</blockquote>\n<p>Because C++ 11 introduced <strong>move semantics</strong>, which, instead of copying data, the compiler will realize that we are copying data unnecessarily, and will instead <em>move</em> the vector from one variable to another. </p>\n<p>Below is an animated representation of what 'moving' looks like:</p>\n<p align=\"center\">\n<p><img src=\"https://github.com/khxia/khxia.github.io/blob/dev2/src/posts/cpp/move.gif?raw=true\"></img></p>\n</p>\n<p>Hence, as we can see, even though we created the <code class=\"language-text\">vector</code> and filled its contents in a local function scope, we were still able to access that <code class=\"language-text\">vector</code> without needing to copy the data; we just made <code class=\"language-text\">data</code> refer to that <code class=\"language-text\">vector</code> instead. Essentially, we 'moved' the original <code class=\"language-text\">vector</code> from one place to another. And that is, the main philosophy behind <strong>move semantics</strong>. </p>\n<p>Aha! Maybe now you can use reverse uno card and <em>flex</em> your C++ knowledge on your manager and tell <strong>him</strong> to upgrade the system to C++11 instead. </p>\n<p align=\"center\">\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 227px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/fea38b96fa871f46fc2eaab0288bc730/1c5de/klee.jpg\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 99.41176470588235%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAUABQDASIAAhEBAxEB/8QAGAABAAMBAAAAAAAAAAAAAAAAAAIDBAX/xAAXAQADAQAAAAAAAAAAAAAAAAABAgMA/9oADAMBAAIQAxAAAAHZDJvAoSClXPF1oW3/xAAbEAACAwEBAQAAAAAAAAAAAAABAgADEhEEMv/aAAgBAQABBQLWo1bmdKQAbDqZ9SytceU9tuOLf//EABoRAAICAwAAAAAAAAAAAAAAAAACARESITH/2gAIAQMBAT8BRdmKC8Kg/8QAGxEAAgEFAAAAAAAAAAAAAAAAAAECAxATMVH/2gAIAQIBAT8BlU4ZGLVv/8QAHhAAAgICAgMAAAAAAAAAAAAAAAECERIhE0FRYYH/2gAIAQEABj8CVyT+DxqK9lSjb8lXTMbydGjk7Rsajo//xAAbEAACAwEBAQAAAAAAAAAAAAABEQAhMUFRcf/aAAgBAQABPyECAWCUWYB3RgrbydjI/JA2ZxGgNhmOLLLYuWFjnyFoo2hP/9oADAMBAAIAAwAAABBICAL/xAAXEQEBAQEAAAAAAAAAAAAAAAABABEh/9oACAEDAQE/EHdJO3QkwY1L/8QAGBEBAAMBAAAAAAAAAAAAAAAAAAERIWH/2gAIAQIBAT8Qsijo2S//xAAdEAEAAwADAAMAAAAAAAAAAAABABEhMUFRYZHB/9oACAEBAAE/ELZENAi+fUsQ0AFp6V1B620VoS0IE0857K8qF2vD9+ZsYBywTq7grDOrhQy/Y9INhVNJxU2Qw0atC2f/2Q=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"double move gif\"\n        title=\"double move gif\"\n        src=\"/static/fea38b96fa871f46fc2eaab0288bc730/1c5de/klee.jpg\"\n        srcset=\"/static/fea38b96fa871f46fc2eaab0288bc730/651be/klee.jpg 170w,\n/static/fea38b96fa871f46fc2eaab0288bc730/1c5de/klee.jpg 227w\"\n        sizes=\"(max-width: 227px) 100vw, 227px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n</p>\n<blockquote>\n<p>Don't do this though</p>\n</blockquote>\n<p>But what is going on behind the scenes? What's the theory behind this all? Well to first understand the theory, we will first introduce <strong>lvalues</strong> and <strong>rvalues</strong> in C++.</p>\n<h2>Introducing <strong>rvalues</strong> and <strong>lvalues</strong> in C++</h2>\n<h3><strong>lvalues</strong></h3>\n<p>An <strong>lvalue</strong> is <em>roughly</em> something that:</p>\n<ul>\n<li>can appear on the left side of an assignment</li>\n<li>has a name</li>\n<li>has an adress</li>\n</ul>\n<p>Using these rough definitions, some examples of <strong>lvalues</strong> might look like:</p>\n<div class=\"gatsby-highlight\" data-language=\"cpp\"><pre class=\"language-cpp\"><code class=\"language-cpp\"><span class=\"token keyword\">int</span> x <span class=\"token operator\">=</span> <span class=\"token number\">10</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> std<span class=\"token operator\">::</span>string hello <span class=\"token operator\">=</span> <span class=\"token string\">\"konnichiwa\"</span><span class=\"token punctuation\">;</span>\nstd<span class=\"token operator\">::</span>string hi <span class=\"token operator\">=</span> <span class=\"token string\">\"annyeong\"</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>In these assigment expressions, <code class=\"language-text\">x</code>, <code class=\"language-text\">hello</code>, and <code class=\"language-text\">hi</code> are all <strong>lvalues</strong>: they have a name and address, and they appear on the left side of an assignment. </p>\n<p><strong>lvalues</strong> are not only variable names though. They can sometimes be expressions too:</p>\n<div class=\"gatsby-highlight\" data-language=\"cpp\"><pre class=\"language-cpp\"><code class=\"language-cpp\">std<span class=\"token operator\">::</span>vector<span class=\"token operator\">&lt;</span><span class=\"token keyword\">int</span><span class=\"token operator\">></span> numbers <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span> <span class=\"token number\">3</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\nnumbers<span class=\"token punctuation\">[</span><span class=\"token number\">2</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// this is an lvalue</span>\n<span class=\"token operator\">*</span><span class=\"token punctuation\">(</span>numbers <span class=\"token operator\">+</span> <span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// this is also an lvalue</span></code></pre></div>\n<p>We see here that even applying <em>certain</em> in operators on <strong>lvalues</strong> in <em>certain</em> situation can still result in an <strong>lvalue</strong>.</p>\n<h3><strong>rvalues</strong></h3>\n<p>An <strong>rvalue</strong> is <em>roughly</em>, something that is not an <strong>lvalue</strong>:</p>\n<ul>\n<li>Temporary objects</li>\n<li>Literal constants</li>\n<li>Function return values (that aren't <strong>lvalue</strong> references)</li>\n<li>Results of built-in operators (that aren't <strong>lvalues</strong>)</li>\n</ul>\n<p><strong>rvalues</strong> generally have a short lifetime</p>\n<p>Hence, some examples include:</p>\n<div class=\"gatsby-highlight\" data-language=\"cpp\"><pre class=\"language-cpp\"><code class=\"language-cpp\"><span class=\"token number\">28</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// an rvalue</span>\n\nstd<span class=\"token operator\">::</span>string <span class=\"token function\">bye</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token string\">\"jal gayo\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token function\">bye</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// an rvalue</span>\nnumbers<span class=\"token punctuation\">.</span><span class=\"token function\">size</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// an rvalue</span>\n<span class=\"token number\">3</span> <span class=\"token operator\">+</span> <span class=\"token number\">2</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// an rvalue</span></code></pre></div>\n<h3>References</h3>\n<p>If you've taken CS31/32, you'll know that we can take references of a variable in C++; it's how pass by reference works. Well in fact, we can take the reference to not just variables, but lvalues, and the syntax is exactly the same: with the <code class=\"language-text\">&amp;</code> sign.</p>\n<div class=\"gatsby-highlight\" data-language=\"cpp\"><pre class=\"language-cpp\"><code class=\"language-cpp\"><span class=\"token keyword\">int</span><span class=\"token operator\">&amp;</span> r0 <span class=\"token operator\">=</span> hello<span class=\"token punctuation\">;</span> <span class=\"token comment\">// okay, variable is an lvalue</span>\n<span class=\"token keyword\">int</span><span class=\"token operator\">&amp;</span> r1 <span class=\"token operator\">=</span> numbers<span class=\"token punctuation\">[</span><span class=\"token number\">2</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// okay, array subscript is an lvalue</span>\n\n<span class=\"token keyword\">int</span><span class=\"token operator\">&amp;</span> r2 <span class=\"token operator\">=</span> <span class=\"token number\">1</span> <span class=\"token operator\">+</span> <span class=\"token number\">2</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// error, this is an rvalue</span></code></pre></div>\n<blockquote>\n<p>It should be noted though, that we can bind a <strong>const lvalue reference</strong> to anything, eg.</p>\n</blockquote>\n<div class=\"gatsby-highlight\" data-language=\"cpp\"><pre class=\"language-cpp\"><code class=\"language-cpp\"><span class=\"token keyword\">const</span> <span class=\"token keyword\">int</span><span class=\"token operator\">&amp;</span> r3 <span class=\"token operator\">=</span> <span class=\"token number\">1</span> <span class=\"token operator\">+</span> <span class=\"token number\">2</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// okay to bind to an rvalue</span></code></pre></div>\n<p>On the other hand, we can actually take the reference of <strong>rvalues</strong> as well. We represent this using the double ampersand sign: <code class=\"language-text\">&amp;&amp;</code> in the declarator.</p>\n<p>One difference with the single <code class=\"language-text\">&amp;</code>, is that we can ONLY bind this to <code class=\"language-text\">rvalues</code>.</p>\n<p>For example, if we had a function <code class=\"language-text\">add</code>:</p>\n<div class=\"gatsby-highlight\" data-language=\"cpp\"><pre class=\"language-cpp\"><code class=\"language-cpp\"><span class=\"token keyword\">int</span> <span class=\"token function\">add</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span><span class=\"token operator\">&amp;&amp;</span> x<span class=\"token punctuation\">,</span> <span class=\"token keyword\">int</span><span class=\"token operator\">&amp;&amp;</span> y<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">int</span> IU_age <span class=\"token operator\">=</span> <span class=\"token number\">28</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">int</span> one <span class=\"token operator\">=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span>\n<span class=\"token function\">add</span><span class=\"token punctuation\">(</span>IU_age<span class=\"token punctuation\">,</span> one<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// wrong, cannot pass in lvalues</span>\n\n<span class=\"token function\">add</span><span class=\"token punctuation\">(</span><span class=\"token number\">28</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// ok, passed in two rvalues</span></code></pre></div>\n<blockquote>\n<p>It is important to note that the usage of an <strong>rvalue</strong> reference is an <strong>lvalue</strong></p>\n</blockquote>\n<div class=\"gatsby-highlight\" data-language=\"cpp\"><pre class=\"language-cpp\"><code class=\"language-cpp\"><span class=\"token keyword\">int</span> <span class=\"token function\">addone</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span><span class=\"token operator\">&amp;&amp;</span> z<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">add</span><span class=\"token punctuation\">(</span>z<span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// wrong, z is now used as an lvalue</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token function\">addone</span><span class=\"token punctuation\">(</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// ok, passed in an rvalue</span></code></pre></div>\n<h2>std::move</h2>\n<p>One function that's very important to us that was introduced in the standard library is the <code class=\"language-text\">std::move</code> function. </p>\n<p>You can look at the <a href=\"https://en.cppreference.com/w/cpp/utility/move\">documentation</a> for more details about the function, but essentially, it does one simple thing:\nIt is a cast that produces an <strong>rvalue reference</strong> to an object, or to be more accurate, it turns the object into an <strong>xvalue</strong> (a type of <strong>rvalue</strong>, it stands for \"eXpiring value\"). It <strong>doesn't actually move anything</strong>, all it does is signal to the compiler that:</p>\n<blockquote>\n<p>You can do anything to me, <strong>move</strong> or destroy any of the resources I am holding or use it elsewhere since I am going to be destroyed soon anyways.</p>\n</blockquote>\n<p>Often times, the most useful situation is when we want to turn an <strong>lvalue</strong> into an <strong>xvalue</strong> so that we can pass it in to a function that expects <strong>rvalue</strong> args.</p>\n<p>Going back to our previous example:</p>\n<div class=\"gatsby-highlight\" data-language=\"cpp\"><pre class=\"language-cpp\"><code class=\"language-cpp\"><span class=\"token keyword\">int</span> <span class=\"token function\">add</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span><span class=\"token operator\">&amp;&amp;</span> x<span class=\"token punctuation\">,</span> <span class=\"token keyword\">int</span><span class=\"token operator\">&amp;&amp;</span> y<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">int</span> IU_age <span class=\"token operator\">=</span> <span class=\"token number\">28</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">int</span> one <span class=\"token operator\">=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span>\n<span class=\"token function\">add</span><span class=\"token punctuation\">(</span>IU_age<span class=\"token punctuation\">,</span> one<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// wrong, cannot pass in lvalues</span>\n\n<span class=\"token function\">add</span><span class=\"token punctuation\">(</span><span class=\"token number\">28</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// ok, passed in two rvalues</span>\n\n<span class=\"token function\">add</span><span class=\"token punctuation\">(</span>std<span class=\"token operator\">::</span><span class=\"token function\">move</span><span class=\"token punctuation\">(</span>IU_age<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> std<span class=\"token operator\">::</span><span class=\"token function\">move</span><span class=\"token punctuation\">(</span>one<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// ok, passed in an rvalue</span>\n\nstd<span class=\"token operator\">::</span>cout <span class=\"token operator\">&lt;&lt;</span> IU_age<span class=\"token punctuation\">;</span> <span class=\"token comment\">// wrong!!! Do not use a variable after it has been std::move'd</span></code></pre></div>\n<p>As we can see, once we <code class=\"language-text\">std::move</code> the <strong>lvalues</strong>, they can then be passed into our <code class=\"language-text\">add</code> function that expects only <strong>rvalues</strong>. </p>\n<blockquote>\n<p>Important note: <strong>DO NOT</strong> use a variable after <code class=\"language-text\">std::move</code> has been called on it. This is undefined behaviour because the compiler could have done anything it wanted to do to that object.</p>\n</blockquote>\n<h2>Move Constructor and Assignment</h2>\n<p>Ok, so how does move semantics work? Well, <strong>move semantic</strong>s allows an object, under certain conditions, to take ownership of the resources of another object. </p>\n<p>Armed with the knowledge of rvalue and rvalue references, we can look at one useful application of it: <strong>move constructors</strong></p>\n<h3>Move Constructor</h3>\n<p>As it's name suggests, <strong>move constructors</strong> simply transfer ownership of a managed resource into the current object. </p>\n<p>Why do we want to do this? Well let's take a look at the following example.</p>\n<div class=\"gatsby-highlight\" data-language=\"cpp\"><pre class=\"language-cpp\"><code class=\"language-cpp\"><span class=\"token keyword\">class</span> <span class=\"token class-name\">Idol</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">int</span> age<span class=\"token punctuation\">;</span>\n    std<span class=\"token operator\">::</span>string name<span class=\"token punctuation\">;</span>\n    <span class=\"token function\">Idol</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> age<span class=\"token punctuation\">,</span> std<span class=\"token operator\">::</span>string name<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// normal constructor</span>\n    <span class=\"token function\">Idol</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">const</span> Idol<span class=\"token operator\">&amp;</span> other<span class=\"token punctuation\">)</span> <span class=\"token operator\">:</span>        <span class=\"token comment\">// copy constructor</span>\n        <span class=\"token function\">age</span><span class=\"token punctuation\">(</span>other<span class=\"token punctuation\">.</span>age<span class=\"token punctuation\">)</span>\n        <span class=\"token function\">name</span><span class=\"token punctuation\">(</span>other<span class=\"token punctuation\">.</span>name<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Now, the interesting part is in the copy constructor. What if, for some reason, we wanted to do something like this:</p>\n<div class=\"gatsby-highlight\" data-language=\"cpp\"><pre class=\"language-cpp\"><code class=\"language-cpp\">Idol <span class=\"token function\">return_IU</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    Idol iu <span class=\"token operator\">=</span> <span class=\"token function\">Idol</span><span class=\"token punctuation\">(</span><span class=\"token number\">28</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"IU\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">return</span> iu<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\nIdol <span class=\"token function\">IU</span><span class=\"token punctuation\">(</span><span class=\"token function\">return_IU</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// copy constructor invoked</span></code></pre></div>\n<p>Here, the copy constructor is invoked because tried to pass in another <code class=\"language-text\">Idol</code> object (<code class=\"language-text\">return_IU()</code>), into the constructor. But what do we notice about the <code class=\"language-text\">Idol</code> object returned by <code class=\"language-text\">return_IU()</code>? It's an <strong>rvalue</strong>! Moreover, we notice that the <code class=\"language-text\">Idol</code> object returned by <code class=\"language-text\">return_IU()</code> will <em>immediately</em> go away/destroyed after the line ends. So then why are we copying, when we can just have our new <code class=\"language-text\">IU</code> object take ownership of the resources owned by the temporary <code class=\"language-text\">Idol</code> object returned by <code class=\"language-text\">return_IU()</code>?</p>\n<p>That is the purpose of <strong>move constructors</strong>, and in practice, it <em>could</em> look something like this:</p>\n<div class=\"gatsby-highlight\" data-language=\"cpp\"><pre class=\"language-cpp\"><code class=\"language-cpp\"><span class=\"token keyword\">class</span> <span class=\"token class-name\">Idol</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">int</span> age<span class=\"token punctuation\">;</span>\n    std<span class=\"token operator\">::</span>string name<span class=\"token punctuation\">;</span>\n    <span class=\"token function\">Idol</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> age<span class=\"token punctuation\">,</span> std<span class=\"token operator\">::</span>string name<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// normal constructor</span>\n    <span class=\"token function\">Idol</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">const</span> Idol<span class=\"token operator\">&amp;</span> other<span class=\"token punctuation\">)</span> <span class=\"token operator\">:</span>        <span class=\"token comment\">// copy constructor</span>\n        <span class=\"token function\">age</span><span class=\"token punctuation\">(</span>other<span class=\"token punctuation\">.</span>age<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>  <span class=\"token comment\">// copies this int</span>\n        <span class=\"token function\">name</span><span class=\"token punctuation\">(</span>other<span class=\"token punctuation\">.</span>name<span class=\"token punctuation\">)</span> <span class=\"token comment\">// copies this string</span>\n    <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n    <span class=\"token function\">Idol</span><span class=\"token punctuation\">(</span>Idol<span class=\"token operator\">&amp;&amp;</span> other<span class=\"token punctuation\">)</span> <span class=\"token keyword\">noexcept</span> <span class=\"token operator\">:</span>   <span class=\"token comment\">// move constructor</span>\n        <span class=\"token function\">age</span><span class=\"token punctuation\">(</span>std<span class=\"token operator\">::</span><span class=\"token function\">move</span><span class=\"token punctuation\">(</span>other<span class=\"token punctuation\">.</span>age<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>   <span class=\"token comment\">// does not copy the int</span>\n        <span class=\"token function\">name</span><span class=\"token punctuation\">(</span>std<span class=\"token operator\">::</span><span class=\"token function\">move</span><span class=\"token punctuation\">(</span>other<span class=\"token punctuation\">.</span>name<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>  <span class=\"token comment\">// does not copy the string</span>\n    <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Here, all the move constructor does, is simply call the <code class=\"language-text\">int</code> move constructor for <code class=\"language-text\">age</code>, and the <code class=\"language-text\">std::string</code> move constructor for <code class=\"language-text\">name</code>. Notice that the way we did this, was to call <code class=\"language-text\">std::move</code> to turn <code class=\"language-text\">other.age</code> and <code class=\"language-text\">other.name</code> (recall that we should now treat these like <strong>lvalues</strong>) into <strong>rvalues</strong>, which will overload and invoke the move constructors for <code class=\"language-text\">int</code> and <code class=\"language-text\">std::string</code>.</p>\n<blockquote>\n<p><strong>Note</strong>: For primitive types like <code class=\"language-text\">int</code>, <code class=\"language-text\">float</code>, <code class=\"language-text\">double</code>, a <strong>move</strong> is the same as <strong>copying</strong> the bits, which means that even though I invoked the move constructor for <code class=\"language-text\">age</code>, all it does is copy the <code class=\"language-text\">int</code>. The reason why I <strong>move</strong> the <code class=\"language-text\">int</code> is just for <strong>demonstration purposes</strong>. This is true for all future instances where I try to 'move' a primitive type.</p>\n</blockquote>\n<p>Generally, a <strong>move constructor</strong> will:</p>\n<ul>\n<li>Transfer ownership of resources from existing objects to object being constructed</li>\n<li>Use subobject's move constructor when possible</li>\n<li>Explicit transfer of resources otherwise (eg. with pointers and file descriptors etc, where <strong>you</strong> are responsible for allocating and deallocating the member variables)</li>\n</ul>\n<p>Now, when we call:</p>\n<div class=\"gatsby-highlight\" data-language=\"cpp\"><pre class=\"language-cpp\"><code class=\"language-cpp\">Idol <span class=\"token function\">IU</span><span class=\"token punctuation\">(</span><span class=\"token function\">return_IU</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// move constructor invoked</span></code></pre></div>\n<p>We will invoke the move constructor, which means that the <code class=\"language-text\">IU</code> object now contains the 'stolen' resources that were once owned by the temporary object returned by <code class=\"language-text\">return_IU()</code>. </p>\n<blockquote>\n<p>Note that whenever we call the move constructor, the original object will be left in an invalid state and we <strong>should not</strong> use that object anymore. In our case, since the temporary object will be deleted immediately after this line, it doesn't concern us.  </p>\n</blockquote>\n<h3>Move assignment</h3>\n<p>Very similar to <strong>move constructor</strong>, a <strong>move assignment</strong> does the same thing, but with the assignment operator instead. </p>\n<p>The goal of the <strong>move assignment</strong> is to free the resources owned by the assigned-to object, and transfer the ownership of resources from assigned-from object to assigned-to object. Again, we should use a subobject's move assignment operator when possible.</p>\n<p>Going back to our <code class=\"language-text\">Idol</code> class:</p>\n<div class=\"gatsby-highlight\" data-language=\"cpp\"><pre class=\"language-cpp\"><code class=\"language-cpp\"><span class=\"token keyword\">class</span> <span class=\"token class-name\">Idol</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">int</span> age<span class=\"token punctuation\">;</span>\n    std<span class=\"token operator\">::</span>string name<span class=\"token punctuation\">;</span>\n    Idol<span class=\"token operator\">&amp;</span> <span class=\"token keyword\">operator</span><span class=\"token operator\">=</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">const</span> Idol<span class=\"token operator\">&amp;</span> other<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>     <span class=\"token comment\">// copy assignment</span>\n        age <span class=\"token operator\">=</span> other<span class=\"token punctuation\">.</span>age<span class=\"token punctuation\">;</span> <span class=\"token comment\">// copies this int</span>\n        name <span class=\"token operator\">=</span> other<span class=\"token punctuation\">.</span>name<span class=\"token punctuation\">;</span> <span class=\"token comment\">// copies this string</span>\n        <span class=\"token keyword\">return</span> <span class=\"token operator\">*</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    Idol<span class=\"token operator\">&amp;</span> <span class=\"token keyword\">operator</span><span class=\"token operator\">=</span><span class=\"token punctuation\">(</span>Idol<span class=\"token operator\">&amp;&amp;</span> other<span class=\"token punctuation\">)</span> <span class=\"token keyword\">noexcept</span> <span class=\"token punctuation\">{</span> <span class=\"token comment\">// move assignment</span>\n        age <span class=\"token operator\">=</span> std<span class=\"token operator\">::</span><span class=\"token function\">move</span><span class=\"token punctuation\">(</span>other<span class=\"token punctuation\">.</span>age<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  <span class=\"token comment\">// does not copy the int</span>\n        name <span class=\"token operator\">=</span> std<span class=\"token operator\">::</span><span class=\"token function\">move</span><span class=\"token punctuation\">(</span>other<span class=\"token punctuation\">.</span>name<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// does not copy the string</span>\n        <span class=\"token keyword\">return</span> <span class=\"token operator\">*</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Again, with the <strong>move assignment</strong> operator, we just overload the assignment operator to expect an argument of type <strong>rvalue reference</strong>, and then we go with convention to invoke the move assignment operators of our member variables. This way, whenever we do assignment from a <strong>rvalue</strong>, it's resources will get <em>moved</em> rather than copied, which is much more efficient.</p>\n<div class=\"gatsby-highlight\" data-language=\"cpp\"><pre class=\"language-cpp\"><code class=\"language-cpp\">Idol IU <span class=\"token operator\">=</span> <span class=\"token function\">Idol</span><span class=\"token punctuation\">(</span><span class=\"token number\">28</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"IU\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nIdol IU2 <span class=\"token operator\">=</span> <span class=\"token function\">Idol</span><span class=\"token punctuation\">(</span><span class=\"token number\">28</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"Lee Ji Eun\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nIU2 <span class=\"token operator\">=</span> IU<span class=\"token punctuation\">;</span> <span class=\"token comment\">// copy assignment operator invoked</span>\nIU2 <span class=\"token operator\">=</span> <span class=\"token function\">Idol</span><span class=\"token punctuation\">(</span><span class=\"token number\">28</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"Cindy\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// move assignment operator invoked</span>\n\n<span class=\"token comment\">// or</span>\n\nIU2 <span class=\"token operator\">=</span> std<span class=\"token operator\">::</span><span class=\"token function\">move</span><span class=\"token punctuation\">(</span>IU<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// move assignment operator invoked</span>\n<span class=\"token comment\">// DO NOT use IU after this</span></code></pre></div>\n<h3>Back to the Opening Problem</h3>\n<p>With our knowledge of <strong>move assignments</strong> and <strong>move constructors</strong>, we can understand now, why our original 'naive' code in C++98 is actually just as efficient in C++11.</p>\n<div class=\"gatsby-highlight\" data-language=\"cpp\"><pre class=\"language-cpp\"><code class=\"language-cpp\">std<span class=\"token operator\">::</span>vector<span class=\"token operator\">&lt;</span>std<span class=\"token operator\">::</span>string<span class=\"token operator\">></span> <span class=\"token function\">build_vector</span><span class=\"token punctuation\">(</span>dbConnection db<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    std<span class=\"token operator\">::</span>vector<span class=\"token operator\">&lt;</span>std<span class=\"token operator\">::</span>string<span class=\"token operator\">></span> vec<span class=\"token punctuation\">;</span>\n    <span class=\"token comment\">// fill the vector with thousands of entries</span>\n    <span class=\"token keyword\">return</span> vec<span class=\"token punctuation\">;</span>   <span class=\"token comment\">// move constructor called</span>\n\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">void</span> <span class=\"token function\">report_statistics</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    std<span class=\"token operator\">::</span>vector<span class=\"token operator\">&lt;</span>std<span class=\"token operator\">::</span>string<span class=\"token operator\">></span> data<span class=\"token punctuation\">;</span>\n    dbConnection singers_db<span class=\"token punctuation\">;</span>\n    dbConnection actors_db<span class=\"token punctuation\">;</span>\n\n    data <span class=\"token operator\">=</span> <span class=\"token function\">build_vector</span><span class=\"token punctuation\">(</span>singers_db<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  <span class=\"token comment\">// move assignment operator called</span>\n    <span class=\"token comment\">// This is because the return value of functions is treated like an rvalue</span>\n    <span class=\"token comment\">// So no need std::move</span>\n\n    <span class=\"token comment\">//  report singer statistics</span>\n\n    data <span class=\"token operator\">=</span> <span class=\"token function\">build_vector</span><span class=\"token punctuation\">(</span>actors_db<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  <span class=\"token comment\">// move assignment operator called</span>\n\n\n    <span class=\"token comment\">// report actor statistics</span></code></pre></div>\n<p>We see that instead of having two copies, we instead invoke the move constructor and move assignment operators.</p>\n<p>In the line:</p>\n<div class=\"gatsby-highlight\" data-language=\"cpp\"><pre class=\"language-cpp\"><code class=\"language-cpp\"><span class=\"token keyword\">return</span> vec<span class=\"token punctuation\">;</span>  </code></pre></div>\n<p>Instead of calling the copy constructor, since the standard library of C++ has defined a move constructor for <code class=\"language-text\">std::vector</code>, then since <code class=\"language-text\">vec</code> is a local variable that is the return value expression, it is treated like a <strong>rvalue</strong>, and hence the move constructor is called instead of the copy constructor. We didn't even need to use <code class=\"language-text\">std::move</code>.</p>\n<p>Now in the lines:</p>\n<div class=\"gatsby-highlight\" data-language=\"cpp\"><pre class=\"language-cpp\"><code class=\"language-cpp\">data <span class=\"token operator\">=</span> <span class=\"token function\">build_vector</span><span class=\"token punctuation\">(</span>singers_db<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\ndata <span class=\"token operator\">=</span> <span class=\"token function\">build_vector</span><span class=\"token punctuation\">(</span>actors_db<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Instead of calling the copy assignment operator, since the standard library of C++ has defined a move assignment operator for <code class=\"language-text\">std::vector</code>, then since the return value of functions are treated like <strong>ravlues</strong>, then it means that the move assignemnt operator is called instead.</p>\n<p>Hah!</p>\n<h2>Another common pattern</h2>\n<p>Often times, it is not just copy constructors and move assignments that we can use move semantics. Another very common use of this kind of overloading using move semantics is in STL containers. </p>\n<p>For example, <code class=\"language-text\">std::vector&lt;T&gt;::push_back</code> has two overloads.</p>\n<div class=\"gatsby-highlight\" data-language=\"cpp\"><pre class=\"language-cpp\"><code class=\"language-cpp\"><span class=\"token keyword\">void</span> <span class=\"token function\">push_back</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">const</span> T<span class=\"token operator\">&amp;</span> value<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">void</span> <span class=\"token function\">push_back</span><span class=\"token punctuation\">(</span>T<span class=\"token operator\">&amp;&amp;</span> value<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>This means that if we did:</p>\n<div class=\"gatsby-highlight\" data-language=\"cpp\"><pre class=\"language-cpp\"><code class=\"language-cpp\">std<span class=\"token operator\">::</span>vector<span class=\"token operator\">&lt;</span>string<span class=\"token operator\">></span> v<span class=\"token punctuation\">;</span>\nstd<span class=\"token operator\">::</span>string str <span class=\"token operator\">=</span> <span class=\"token string\">\"Hello\"</span><span class=\"token punctuation\">;</span>\n\nstd<span class=\"token operator\">::</span>string <span class=\"token function\">bye</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token string\">\"bye\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\nv<span class=\"token punctuation\">.</span><span class=\"token function\">push_back</span><span class=\"token punctuation\">(</span>str<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// copy</span>\n\nv<span class=\"token punctuation\">.</span><span class=\"token function\">push_back</span><span class=\"token punctuation\">(</span><span class=\"token function\">bye</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// move</span></code></pre></div>\n<p>Similar with the move constructors, when we call <code class=\"language-text\">push_back</code> on an <code class=\"language-text\">lvalue</code>, the <code class=\"language-text\">string</code> is copied. But for <strong>rvalues</strong> and <strong>xvalues</strong>, the compiler knows that you don't need it anymore and it can do whatever it wants with it; the second overloaded <code class=\"language-text\">push_back</code> function is called where the data is <em>moved</em> instead. </p>\n<p>Note that you can do this to an <strong>lvalue</strong> like <code class=\"language-text\">str</code>, but we must use the <code class=\"language-text\">std::move</code> function to do the <em>move</em>.</p>\n<div class=\"gatsby-highlight\" data-language=\"cpp\"><pre class=\"language-cpp\"><code class=\"language-cpp\">v<span class=\"token punctuation\">.</span><span class=\"token function\">push_back</span><span class=\"token punctuation\">(</span>std<span class=\"token operator\">::</span><span class=\"token function\">move</span><span class=\"token punctuation\">(</span>str<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// move</span></code></pre></div>\n<p>This is actually a very common thing to do. If <code class=\"language-text\">str</code> is an extremely large string, and we know that we are actually done with <code class=\"language-text\">str</code> after we push it back into the vector, then we can just <em>move</em> the data held by <code class=\"language-text\">str</code> instead of copying it.</p>\n<p align=\"center\">\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 348px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/61721ca75abd1a73563c772d2e6d9d8b/987c4/bts.jpg\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 68.82352941176471%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAOABQDASIAAhEBAxEB/8QAFwAAAwEAAAAAAAAAAAAAAAAAAAIEA//EABYBAQEBAAAAAAAAAAAAAAAAAAABAv/aAAwDAQACEAMQAAABnVdMyQYP/8QAGRAAAwEBAQAAAAAAAAAAAAAAAQIDABAT/9oACAEBAAEFAlHrrTKcWhVqVLjf/8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAwEBPwE//8QAFREBAQAAAAAAAAAAAAAAAAAAARD/2gAIAQIBAT8BCf/EABkQAAIDAQAAAAAAAAAAAAAAAAERABAhAv/aAAgBAQAGPwJY5oVMQPkZX//EABsQAAIDAAMAAAAAAAAAAAAAAAARASExQXGh/9oACAEBAAE/IXkjwJCJQnBPGKJlGqVQ54ro/9oADAMBAAIAAwAAABA4z//EABYRAQEBAAAAAAAAAAAAAAAAAAARAf/aAAgBAwEBPxDKj//EABcRAQADAAAAAAAAAAAAAAAAAAABESH/2gAIAQIBAT8Qgpj/xAAaEAEBAAMBAQAAAAAAAAAAAAABEQAhMUFR/9oACAEBAAE/EFindDQvucNSQ2ph0CPubnmtmYcKK0ruYMuhPKmf/9k='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"bts\"\n        title=\"bts\"\n        src=\"/static/61721ca75abd1a73563c772d2e6d9d8b/987c4/bts.jpg\"\n        srcset=\"/static/61721ca75abd1a73563c772d2e6d9d8b/651be/bts.jpg 170w,\n/static/61721ca75abd1a73563c772d2e6d9d8b/d30a3/bts.jpg 340w,\n/static/61721ca75abd1a73563c772d2e6d9d8b/987c4/bts.jpg 348w\"\n        sizes=\"(max-width: 348px) 100vw, 348px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n</p>\n<h2>Conclusion</h2>\n<p>The applications of move semantics don't end here! All I introduced here today was how <strong>move semantics</strong> can turn expensive copies into cheap moves. There are many other places where <strong>move semantics</strong> is useful eg. implementing 'move-only' types, perfect forwarding etc. But that will not be discussed here. </p>\n<p>I just want to conclude by reiterating the fact that in CS31 and CS32 (or any intro CS class taught in C++), the C++ that they teach is <em>very</em> very old. Since then, many new features have come out and have made C++ much more versatile and easier to write code in. </p>\n<p>This is not only true for C++, but for any programming language that you learn, so it's important to <strong>keep learning</strong> and keep being in touch with new language updates. Admittedly, I am not that best at doing this as well, so I think it's a work in progress for all of us.</p>\n<p>If you've made it to end, as always, thank you for reading and looking at my memes.</p>\n<h2>Sources</h2>\n<p><a href=\"https://stackoverflow.com/questions/3106110/what-is-move-semantics\">What is Move Semantics - Stack Overflow</a></p>\n<p><a href=\"https://www.youtube.com/watch?v=ZG59Bqo7qX4\">Back to Basics: Move Semantics - David Olsen - CppCon 2020</a></p>\n<p><a href=\"https://www.youtube.com/watch?v=TFMKjL38xAI\">Hidden Secrets of Move Semantics - Nicolai Josuttis - CppCon 2020</a></p>","frontmatter":{"date":"September 22nd 2021","path":"/posts/cpp/move-semantics","title":"Introduction to Move Semantics in C++","topic":"C++, Move Semantics"}}},"pageContext":{}},"staticQueryHashes":["3649515864","63159454"]}